
# ClinicPro Architecture Overview

## Core Technologies
- **Framework**: Next.js 14 (App Router)
- **Database**: PostgreSQL with Drizzle ORM
- **Styling**: Tailwind CSS with shadcn/ui
- **Authentication**: Clerk
- **Payments**: Stripe
- **AI**: OpenAI GPT-4
- **Transcription**: Deepgram
- **Realtime**: Ably
- **Vector Search**: Pinecone (for RAG)

## Key Systems

### Tier-Based Access Control (RBAC)
- **Tiers**: basic → standard → premium → admin
- **Auth**: Clerk with tier-based permissions (public → basic → standard → premium → admin)
- **Rate Limiting**: Tier-based limits (5/day basic, unlimited standard+)
- **Billing**: Stripe integration with tier-based subscriptions

### Core Features
- **Clinical AI**: GPT-4 powered consultation assistance
- **Speech-to-Text**: Deepgram integration for real-time transcription
- **Template System**: Customizable documentation templates
- **Session Management**: Patient session tracking and history
- **Mobile Integration**: QR code mobile recording interface

### Data Flow
1. **User Input**: Voice/text → Deepgram → OpenAI
2. **AI Processing**: Clinical context → GPT-4 → Structured output
3. **Template Rendering**: User templates → Dynamic forms
4. **Data Storage**: PostgreSQL → Encrypted clinical data
5. **Realtime Updates**: Ably → Live UI updates

## Security Architecture

### Authentication Flow
1. **Clerk Authentication**: OAuth providers + email/password
2. **Tier Assignment**: Webhook assigns 'basic' tier to new users
3. **Session Management**: JWT tokens with tier metadata
4. **Route Protection**: Middleware enforces tier-based access

### Data Protection
- **Encryption**: AES-256 for sensitive clinical data
- **Access Control**: Tier-based permissions
- **Audit Logging**: All clinical actions tracked
- **GDPR Compliance**: Data export/deletion capabilities

## Performance Optimizations

### Caching Strategy
- **Next.js**: ISR for static content
- **Database**: Query optimization with indexes
- **CDN**: Static assets via Vercel Edge

### Rate Limiting
- **Tier-based**: 5 requests/day (basic) → unlimited (standard+)
- **Sliding Window**: 24-hour rolling periods
- **Graceful Degradation**: Tier upgrade prompts

## Deployment Architecture

### Production Environment
- **Hosting**: Vercel (Next.js optimized)
- **Database**: Supabase PostgreSQL
- **DNS**: Cloudflare (security + performance)
- **Monitoring**: Vercel Analytics + custom logging

### Development Workflow
- **Version Control**: Git with feature branches
- **CI/CD**: Vercel automatic deployments
- **Testing**: Jest + Playwright for E2E
- **Code Quality**: ESLint + Prettier + TypeScript

## API Design

### RESTful Endpoints
- **Authentication**: `/api/auth/*` (Clerk integration)
- **Clinical**: `/api/clinical/*` (AI features)
- **Templates**: `/api/templates/*` (CRUD operations)
- **Billing**: `/api/billing/*` (Stripe integration)
- **Admin**: `/api/admin/*` (admin-only features)

### Real-time Features
- **WebSockets**: Ably for live transcription
- **Server-Sent Events**: Live session updates
- **Mobile Sync**: QR code + token-based access

## Scalability Considerations

### Horizontal Scaling
- **Stateless APIs**: Session data in JWT tokens
- **Database Sharding**: User-based partitioning ready
- **CDN Distribution**: Global edge caching

### Vertical Scaling
- **Database Optimization**: Proper indexing strategy
- **Caching Layers**: Redis for session data
- **Background Jobs**: Queue-based processing

## Monitoring & Observability

### Application Metrics
- **Performance**: Response times, error rates
- **Business**: User engagement, conversion rates
- **Security**: Authentication events, access patterns

### Error Handling
- **Graceful Degradation**: Fallback mechanisms
- **User Feedback**: Clear error messages
- **Developer Alerts**: Real-time error notifications

## Future Architecture Goals

### Microservices Migration
- **Service Separation**: Clinical AI, Templates, Billing
- **API Gateway**: Unified external interface
- **Service Mesh**: Inter-service communication

### Advanced Features
- **Machine Learning**: Predictive clinical insights
- **Mobile Apps**: Native iOS/Android applications
- **Enterprise**: Multi-tenant architecture
- **Compliance**: HIPAA/SOC 2 certification

- **❌ Avoid**: Cross-feature dependencies
- **✅ Use**: Shared code via `src/shared/`
- **❌ Avoid**: Mixing business domains in components
- **✅ Use**: Clear feature boundaries with well-defined interfaces
