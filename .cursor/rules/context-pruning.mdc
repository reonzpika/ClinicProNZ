---
description: 
globs: 
alwaysApply: true
---
# 1. File Tiers & Token Budgets  
- **Tier 1 (50% tokens)**  
  - Files open in editor / recently edited (< 24 h)  
  - Critical config (e.g., `drizzle.config.ts`, `next.config.js`)  
- **Tier 2 (25% tokens)**  
  - Core domain modules (`db/**`, `pages/api/**`, `components/core/**`)  
- **Tier 3 (15% tokens)**  
  - High‑level docs (`README.md`, `architecture.md`) only if “docs” in query  
- **Tier 4 (10% tokens)**  
  - Other code, *only* filenames & imports—no bodies  
- **Always Exclude**  
  - `node_modules/`, build outputs, binaries, tests > 500 KB

# 2. Dynamic Summaries  
- For any Tier 2+ file > 300 lines:  
  - Include only a 3‑line auto‑summary of its purpose and exports.  
- If file > 600 lines:  
  - Exclude full content—keep just filename + export list.

# 3. On‑Demand Expansion  
- By default, collapse Tier 3 & 4 to filenames.  
- If prompt mentions “see details” or “expansion,” load full content up to 100 lines.

# 4. Token Cap Enforcement  
- If cumulative tokens > 75% of context window:  
  - Drop oldest Tier 2 file summaries first.  
  - Then collapse Tier 1 to 5‑line diffs only.

# 5. Query‑Driven Focus  
- If user query mentions a folder or keyword:  
  - Promote matching files one tier up (e.g. Tier 3 → 2)  
  - Demote unrelated Tier 1 files down one level.

# 6. Metadata‑Only for Large Files  
- For any file with > 5 imports:  
  - Only include import list + export signatures.

# 7. Exclusions & Overrides  
- Never prune `cursor-agent.mdc` or other rule files.  
- Honor any file‑specific `// @cursor: keep` or `// @cursor: exclude` comments.


