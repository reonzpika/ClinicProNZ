# New Zealand Healthcare Domain Context

## üè• Healthcare System Specifics

### ACC (Accident Compensation Corporation)
- **Purpose**: No-fault injury compensation system
- **Requirement**: All injury-related consultations need ACC codes
- **Implementation**: Auto-suggest ACC codes based on consultation content
- **Common codes**: ACC45 (initial injury), ACC6343 (follow-up treatment)

### RNZCGP (Royal New Zealand College of General Practitioners)
- **Standards**: Documentation and clinical practice guidelines
- **Requirements**: SOAP note structure, consultation standards
- **Templates**: Must align with RNZCGP documentation expectations

### Privacy Act 2020 (Critical)
- **Patient consent**: Required for all recordings
- **Data storage**: End-to-end encryption mandatory
- **Access controls**: Strict role-based access
- **Audit trails**: All patient data access must be logged

### Common EHR Systems
- **MedTech Evolution**: Most common in NZ
- **Profile**: Secondary EHR system  
- **Integration requirement**: Export compatibility essential

## üìã Clinical Workflow Patterns

### Standard Consultation Flow
```
1. Patient Consent (verbal/digital)
   ‚Üì
2. Recording Start (desktop mic OR mobile QR)
   ‚Üì  
3. Real-time Transcription (Deepgram medical model)
   ‚Üì
4. Template Selection (auto or manual)
   ‚Üì
5. AI Note Generation (OpenAI with clinical prompts)
   ‚Üì
6. GP Review & Edit (always required)
   ‚Üì
7. Export to EHR (MedTech/Profile format)
```

### Template DSL Structure
```typescript
type TemplateDSL = {
  overallInstructions?: string;  // NZ context instructions
  sections: SectionDSL[];
};

type SectionDSL = {
  heading: string;               // Professional headings
  prompt: string;                // AI extraction instructions
  subsections?: SectionDSL[];    // Hierarchical structure
};
```

### Template Categories
- **General Consultation**: Standard GP visit
- **Specialist Referral**: Letter format with clinical question
- **Follow-up**: Progress monitoring 
- **Preventive Care**: Health screening focus
- **Mental Health**: Risk assessment + safety planning
- **Injury Assessment**: ACC code integration

## ü©∫ Clinical Decision Support

### Differential Diagnosis Support
- **Integration**: OpenAI clinical reasoning
- **Context**: NZ clinical guidelines via RAG system
- **Output**: Ranked differential diagnoses
- **Limitation**: GP retains all clinical decisions

### Clinical Image Analysis
- **Types**: Skin lesions, rashes, wounds
- **AI Model**: GPT-4o vision capabilities
- **Output**: Descriptive analysis + suggestions
- **Compliance**: Never diagnostic, always supportive

### RAG Clinical Guidelines
- **Sources**: BPAC, Ministry of Health, HealthPathways
- **Query**: Natural language clinical questions
- **Response**: Evidence-based guidance with citations
- **Update cycle**: Manual ingestion (Phase 1)

## üîí Clinical Data Handling

### Patient Session Management
```typescript
// Patient sessions support both authenticated and guest users
patientSessions: {
  userId?: string;           // Authenticated user
  guestToken?: string;       // Anonymous session
  patientName?: string;      // Optional patient identifier
  status: 'active' | 'completed' | 'archived';
  transcriptions: string;    // JSON array of transcripts
  notes: string;            // Generated clinical notes
  clinicalImages?: string;   // JSON array of images
}
```

### Consent Management
- **Digital consent**: In-app consent workflow
- **Verbal consent**: Recorded as part of transcription
- **Withdrawal**: Patient can request deletion anytime
- **Audit**: All consent decisions logged

### Data Retention
- **Active sessions**: 30 days for free users, unlimited for paid
- **Archived sessions**: User-controlled deletion
- **Guest sessions**: 24-hour automatic deletion
- **Clinical images**: Same retention as consultation data

## üìä Clinical Quality Metrics

### Note Generation Quality
- **Accuracy**: Clinical information extraction precision
- **Completeness**: All consultation elements captured
- **Format**: SOAP structure compliance
- **Time**: <1 minute generation target

### Template Performance
- **Usage tracking**: Most/least used templates
- **Generation success**: Failed note generation rates
- **User satisfaction**: GP edit frequency/extent
- **Clinical relevance**: Template effectiveness metrics

## üö® Clinical Safety Protocols

### Critical Information Handling
- **Red flags**: Suicide risk, domestic violence, child safety
- **Urgent referrals**: Emergency department, mental health crisis
- **Follow-up requirements**: Mandatory follow-up appointments
- **Documentation standards**: Critical information prominence

### Error Prevention
- **Double-check prompts**: GP review always required
- **Clinical reasoning**: AI explanations for suggestions
- **Contraindication warnings**: Drug interactions, allergies
- **Version control**: Note edit history maintained

## üíä Medication Management

### Prescribing Support (Future)
- **Drug database**: NZULM (New Zealand Universal List of Medicines)
- **Interaction checking**: Clinical decision support
- **Dosing guidance**: Age/weight-based recommendations
- **Generic substitution**: Cost-effective alternatives

### Current Implementation
- **Medication extraction**: From consultation transcription
- **Format standardisation**: Generic name + dosage + frequency
- **Allergy checking**: Manual GP verification required
description:
globs:
alwaysApply: false
---
