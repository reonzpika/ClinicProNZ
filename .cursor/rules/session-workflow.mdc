---
description: "Session workflow, mode detection, and work patterns"
alwaysApply: true
version: "1.0.0"
priority: HIGH
load_order: 1
last_updated: "2026-01-01"
---

# Session Workflow & Mode Detection

## Session Initialization

When user says generic greeting ("hi", "hello", "hey", "what's up", "yo", etc.):

1. Read: `CURRENT-WORK.md`, `PORTFOLIO.md`
2. Provide briefing (keep concise, under 12 lines)

**Format:**
```
[Greeting], ready to work.

üìç Priorities: [Top priorities from CURRENT-WORK.md]
üìä Status: [Key metrics if present in CURRENT-WORK.md]

‚îÅ‚îÅ‚îÅ ACTIVE PROJECTS ‚îÅ‚îÅ‚îÅ
1. **[Project Name]** (PRIMARY) - [Current status/goal]
2. **[Project Name]** (SECONDARY) - [Current status/goal]
   
   Other: [List inactive projects briefly]

‚îÅ‚îÅ‚îÅ COMMON ACTIONS ‚îÅ‚îÅ‚îÅ
‚Ä¢ "what should i work on?" - Daily task recommendation
‚Ä¢ "plan today" - Update CURRENT-WORK.md active queue
‚Ä¢ "plan week" - Update CURRENT-WORK.md priorities
‚Ä¢ "daily check" - Quick standup
‚Ä¢ "weekly review" - Week review + planning next week
‚Ä¢ "check progress" - Metrics and goal tracking

Or just tell me what you want to do.
```

3. Wait for user direction (don't assume what to work on)

---

## Mode Detection & Workflow

Detect mode based on user's message and follow appropriate pattern.

### ü§î THINKING Mode

**Triggers:**
- "Should I build..."
- "Is it worth..."
- "What do you think about..."
- "Should I pivot..."
- "build [something]" (requires planning first)
- "implement [something]" (requires planning first)
- "create [something]" (requires planning first)

**Pattern:**
1. **Check for project-specific rules:**
   - If working on a specific project, check if `PROJECT_RULES.md` exists
   - Medtech Integration has PROJECT_RULES.md (hard constraints, workflows, testing requirements)
   - Read PROJECT_RULES.md before planning if it exists
   - PROJECT_SUMMARY.md will indicate if PROJECT_RULES.md exists (check frontmatter `key_docs.project_rules`)

2. **Determine sub-type:**
   - Strategic discussion (should I build this?) ‚Üí Business analysis
   - Code planning (build this feature) ‚Üí Technical planning + library search
   - Architecture decision (how should I structure this?) ‚Üí Design discussion

2. **For Strategic Discussion:**
   - Ask business validation questions:
     - Have customers asked for this?
     - What would they pay?
     - Time to build vs opportunity cost?
   - Show trade-offs clearly
   - Challenge assumptions
   - Stay in CHAT (no documents during discussion)
   - End with: "What's your take?" or "What's driving this idea?"

3. **For Code Planning:**
   - **Check project-specific constraints** (read PROJECT_RULES.md if exists)
   - **MANDATORY: Use library-first-approach.mdc**
   - Search for existing solutions FIRST (npm + GitHub + Stack Overflow + dev.to + Medium)
   - Present findings (libraries, repos, patterns, articles)
   - **Verify against PROJECT_RULES.md constraints** (if applicable)
   - Show detailed pseudocode plan:
     - Architecture overview
     - Step-by-step implementation
     - Error handling approach
     - Trade-offs and decisions
     - Time estimate
     - Note any PROJECT_RULES.md constraints that apply
   - End with: **"Proceed with implementation?"**
   - **WAIT for approval before coding**

4. **For Architecture Discussion:**
   - Explore options (patterns, approaches)
   - Show pros/cons of each
   - Recommend based on context
   - Stay in CHAT
   - End with: "Which approach feels right?"

**Critical Rules:**
- ‚ùå NO documents during THINKING mode (stay in chat)
- ‚ùå NO coding before plan is approved
- ‚úÖ USE web search for code planning (find libraries, repos, examples)
- ‚úÖ WAIT for user approval before moving to DOING mode

---

### ‚ö° DOING Mode

**Triggers:**
- User approves plan ("yes", "go ahead", "do it", "proceed")
- Explicit command ("just fix it", "write the code")
- Debugging (error messages, "this isn't working")

**Pattern:**
1. **Create todos (if modifying code)**
   - Create todos with implementation steps + 3 final todos (build/docs/log)
   - Use `TodoWrite` with `merge: false`
   - Mark first todo as `in_progress`

2. **Execute the approved plan**
   - Write code efficiently
   - Follow the pseudocode/plan discussed
   - Update todo status as you progress
   - Explain briefly what you're doing (1-2 lines)
   - Don't add features beyond the plan

3. **For Code Implementation:**
   - Write complete, working code
   - Include error handling
   - Add brief comments for complex logic
   - Follow existing code style
   - Mark implementation todos completed as you finish each

4. **For Debugging:**
   - Read relevant code/error messages
   - Diagnose issue (explain what's wrong)
   - Suggest fix
   - Implement fix if user approves
   - Test the fix

5. **Complete final todos (ALWAYS before reporting done):**
   - Build, test, and fix all errors
   - Propose documentation updates (PROJECT_SUMMARY.md + PORTFOLIO.md + CURRENT-WORK.md if needed); apply after user approval
   - Update project LOG.md (if significant milestone); apply after user approval
   - Mark all todos completed

6. **Report completion:**
   - "Done. Created/Fixed: [what was built]"
   - Confirm all todos completed
   - Mention any deviations from plan (if any)

**Critical Rules:**
- ‚úÖ Stay focused (implement what was approved, not extras)
- ‚úÖ Keep it working (don't break existing functionality)
- ‚úÖ Create todos when entering DOING mode (for code changes)
- ‚úÖ Complete ALL todos before reporting done
- ‚ùå Don't start new THINKING without user prompt
- ‚ùå NEVER say "done" with pending todos

---

### üìä REVIEWING Mode

**Triggers:**
- "weekly review"
- "monthly review"  
- "daily check"
- "check progress"
- "how are we doing?"
- "what's blocking?"

**Pattern:**
1. **Ask structured questions** (based on review type):

   **Daily Check:**
   - "What did you get done yesterday?"
   - "What's the plan today?"
   - "Anything blocking you?"

   **Weekly Review:**
   - "Did you hit this week's primary priority?" (YES/NO + why)
   - "How many customer conversations?" (number + what learned)
   - "Time split: Building vs Customer/Business?" (rough hours)
   - "Key decisions made this week?"
   - "What's blocking progress?"
   - "What are next week's top priorities?"

   **Monthly Review:**
   - Review quarterly goals from annual planning
   - Check metrics (paying clinics, MRR, features shipped)
   - Identify patterns (what's working, what's not)
   - Strategic adjustments needed?

2. **Analyze progress:**
   - Compare actual vs planned
   - Identify trends (good and bad)
   - Highlight kill signals if relevant
   - Suggest adjustments

3. **End with action:**
   - Set next period's priorities
   - Ask: "Should I update CURRENT-WORK.md?" or "Should I add an entry to a project LOG.md?"
   - **ONLY create/update docs if user confirms**

**Critical Rules:**
- ‚úÖ Data-driven (use metrics, not feelings)
- ‚úÖ Honest (call out lack of progress)
- ‚úÖ Forward-looking (what's next?)
- ‚ùå Don't create docs automatically (ask first)

---

## Todo List Integration

### Purpose: Prevent Forgetting Critical Final Steps

**Problem:** After long coding sessions, AI forgets to:
- Run build and fix errors
- Update documentation
- Update weekly log

**Solution:** Use todos as persistent memory/checklist that AI cannot ignore.

---

### When to Create Todos

**Create todos ANY time AI enters DOING mode (writes/modifies code):**

1. **User approves implementation plan** ("proceed", "yes", "go ahead")
2. **User gives multi-step coding task**
3. **AI starts modifying code for any reason**

**Even for "quick fixes"** - still create minimum 3 final todos (prevents forgotten steps).

**Skip todos only when:**
- Pure strategic discussion (no code changes)
- Weekly review / progress check (REVIEWING mode)
- User just exploring options (no implementation yet)

---

### Todo Structure

**For complex work (3+ implementation steps):**
```
1. [First implementation step] - in_progress
2. [Second implementation step] - pending
3. [Third implementation step] - pending
...
N-2. Build, test, and fix all errors - pending
N-1. Propose documentation updates (PROJECT_SUMMARY.md + PORTFOLIO.md + CURRENT-WORK.md if needed) - pending
N. Update project LOG.md (if significant milestone) - pending
```

**For simple work (< 3 steps):**
```
1. [Implementation task] - in_progress
2. Build, test, and fix all errors - pending
3. Propose documentation updates (PROJECT_SUMMARY.md + PORTFOLIO.md + CURRENT-WORK.md if needed) - pending
4. Update project LOG.md (if significant milestone) - pending
```

**The 3 final todos are ALWAYS added when coding.**

---

### Todo Execution Rules

**During implementation:**
- Update todo status as you progress (pending ‚Üí in_progress ‚Üí completed)
- Mark completed immediately after finishing each step
- Use `merge: true` to update existing todos

**Build, test, and fix all errors:**
- Run build command (`pnpm build` or relevant)
- Fix any compilation/type errors
- Run build again until it passes
- Manually verify feature works as expected
- Run automated tests if they exist
- Clean up debug code (console.logs, commented code)

**Update documentation:**
- Update `/project-management/[project]/PROJECT_SUMMARY.md` (status, milestones, decisions)
- Update `/project-management/PORTFOLIO.md` (one-line project status only)
- Update `/project-management/CURRENT-WORK.md` (priorities and active queue) if needed
- Update technical docs if relevant (API docs, architecture, etc.)
- Add/update code comments for complex logic

**Update project log:**
- Only if significant milestone reached
- Location: `/project-management/[project]/LOG.md`
- Include: progress, evidence, decisions, blockers
- Ask user: "Should I add an entry to the project log?"

**Critical Rule:**
> **Never report work as "done" with pending todos. Check todo list before completion. If ANY todos are pending, complete them first.**

---

### Todo Status Management

Use `TodoWrite` tool with `merge: true` to update status:

**Starting work (generic template):**
```typescript
TodoWrite({
  merge: false,  // Create new todos
  todos: [
    { id: "1", content: "[First implementation step]", status: "in_progress" },
    { id: "2", content: "[Second implementation step]", status: "pending" },
    { id: "3", content: "[Third implementation step]", status: "pending" },
    // ... more implementation steps as needed
    { id: "N-2", content: "Build, test, and fix all errors", status: "pending" },
    { id: "N-1", content: "Propose documentation updates (PROJECT_SUMMARY.md + PORTFOLIO.md + CURRENT-WORK.md if needed)", status: "pending" },
    { id: "N", content: "Update project LOG.md (if significant)", status: "pending" }
  ]
})
```

**Example 1: Building a feature (login form)**
```typescript
TodoWrite({
  merge: false,
  todos: [
    { id: "1", content: "Create login form component", status: "in_progress" },
    { id: "2", content: "Implement authentication logic", status: "pending" },
    { id: "3", content: "Add error handling", status: "pending" },
    { id: "4", content: "Build, test, and fix all errors", status: "pending" },
    { id: "5", content: "Propose documentation updates (PROJECT_SUMMARY.md + PORTFOLIO.md + CURRENT-WORK.md if needed)", status: "pending" },
    { id: "6", content: "Update project LOG.md (if significant)", status: "pending" }
  ]
})
```

**Example 2: Fixing a bug (simple)**
```typescript
TodoWrite({
  merge: false,
  todos: [
    { id: "1", content: "Fix TypeScript error in user service", status: "in_progress" },
    { id: "2", content: "Build, test, and fix all errors", status: "pending" },
    { id: "3", content: "Propose documentation updates (PROJECT_SUMMARY.md + PORTFOLIO.md + CURRENT-WORK.md if needed)", status: "pending" },
    { id: "4", content: "Update project LOG.md (if significant)", status: "pending" }
  ]
})
```

**During work (updating progress):**
```typescript
TodoWrite({
  merge: true,  // Update existing todos
  todos: [
    { id: "1", status: "completed" },           // Just finished step 1
    { id: "2", status: "in_progress" }          // Now starting step 2
  ]
})
```

---

### Example: Todo-Driven Development Flow

```
User: "build user profile page with avatar upload"
‚Üì
AI: [THINKING mode] searches libraries, shows plan
‚Üì
User: "proceed"
‚Üì
AI: "Proceeding with implementation"
AI: [Creates todos]:
  1. Create profile page component - in_progress
  2. Implement avatar upload with image compression - pending
  3. Add form validation - pending
  4. Build, test, and fix all errors - pending
  5. Update documentation (PROJECT_SUMMARY + PROJECTS_OVERVIEW) - pending
  6. Update weekly log (if significant) - pending
‚Üì
AI: [Creates profile page component]
AI: [Marks todo 1 completed, moves to todo 2]
‚Üì
AI: [Implements avatar upload]
AI: [Marks todo 2 completed, moves to todo 3]
‚Üì
AI: [Adds form validation]
AI: [Marks todo 3 completed, moves to todo 4]
‚Üì
AI: [Runs build] ‚Üí errors found (TypeScript type issue)
AI: [Fixes type errors]
AI: [Runs build] ‚Üí success
AI: [Tests feature in browser] ‚Üí works
AI: [Marks todo 4 completed, moves to todo 5]
‚Üì
AI: [Updates PROJECT_SUMMARY.md with new feature]
AI: [Proposes updates to PORTFOLIO.md (and CURRENT-WORK.md if needed); applies after approval]
AI: [Marks todo 5 completed, moves to todo 6]
‚Üì
AI: "This was a significant feature. Should I add an entry to the project LOG.md?"
User: "yes"
AI: [Updates project LOG.md]
AI: [Marks todo 6 completed]
‚Üì
AI: "Done. All todos completed. User profile page implemented and documented."
```

---

## Universal Work Pattern

**ALL work follows this pattern:**

```
THINKING ‚Üí (User Approval) ‚Üí DOING ‚Üí (Review if needed)
```

**Examples:**

**Strategic Decision:**
```
THINKING: Discuss business value, trade-offs
‚Üì (User decides)
DOING: Maybe document decision (if significant)
```

**Code Feature:**
```
THINKING: Search libraries + pseudocode plan + "Proceed?"
‚Üì (User approves)
DOING: Create todos (implementation steps + 3 final todos)
       Write the code
       Update todo status as progressing
       Build, test, fix errors
       Propose doc updates (PROJECT_SUMMARY + PORTFOLIO + CURRENT-WORK if needed); apply after approval
       Update project LOG.md (if significant); apply after approval
       Mark all todos completed
```

**Bug Fix:**
```
THINKING: Diagnose issue + suggest fix
‚Üì (User approves)  
DOING: Create todos (fix + 3 final todos)
       Implement fix
       Build, test, fix errors
       Update documentation (if needed)
       Update project LOG.md (if significant)
       Mark all todos completed
```

**Weekly Review:**
```
REVIEWING: Ask questions + analyze progress
‚Üì (Discussion)
THINKING: "Based on this, next week should focus on X"
‚Üì (User confirms)
DOING: Update CURRENT-WORK.md (if approved)
```

---

## The Golden Rule: CHAT FIRST, DOCS ONLY WHEN DECIDED

**Keep in CHAT:**
- ‚úÖ All discussions
- ‚úÖ All thinking and exploring
- ‚úÖ "What if we..." conversations
- ‚úÖ Brainstorming options
- ‚úÖ Planning and pseudocode
- ‚úÖ Strategic debates

**Create/Update DOCS only when:**
- ‚úÖ User explicitly requests ("document this")
- ‚úÖ Major milestone completed (feature shipped, project status change)
- ‚úÖ Decision made that needs tracking
- ‚úÖ Weekly/monthly review completed (if user approves)
- ‚úÖ End of session with significant decisions (ask first)

**If tempted to create doc during discussion:**
‚Üí DON'T. Keep it in chat.
‚Üí At end, ask: "Should I document any of this?"

---

## Mode Transition Phrases

**Entering THINKING mode:**
- "Let me plan this out first..."
- "Let's think through this..."
- "Before we build, let me search for solutions..."

**Moving to DOING mode:**
- "Proceeding with implementation..."
- "Implementing now..."
- "Fixing this..."

**Entering REVIEWING mode:**
- "Let's review progress..."
- "Time for a check-in..."

---

## Session Ending

Before session ends (user says "done", "that's all", "thanks", etc.):

1. **Check: Any incomplete todos?**
   - If YES: "You have [N] pending todos. Should I complete them first?"
   - List pending todos
   - Wait for user decision (complete or defer)
   - If defer: Note in next session

2. **Check: Any decisions to document?**
   - If YES: "Should I update [specific file] with [specific decisions]?"
   - If NO: "Nothing to document. Great session."

3. **Quick summary** (if significant work done):
   - "This session: [what we accomplished]"
   - "Next: [suggested next action]"

4. **Don't create docs unless user confirms**

---

# End of Session Workflow
